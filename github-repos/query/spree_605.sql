SELECT COUNT(count_column) FROM (SELECT DISTINCT `spree_variants`.`id` AS count_column FROM `spree_variants` INNER JOIN `spree_prices` ON `spree_prices`.`deleted_at` IS NULL AND `spree_prices`.`variant_id` = `spree_variants`.`id` WHERE `spree_variants`.`deleted_at` IS NULL AND (`spree_variants`.`is_master` = FALSE OR ( `spree_variants`.id IN ( SELECT MIN(`spree_variants`.id) FROM `spree_variants` GROUP BY `spree_variants`.product_id HAVING COUNT(*) = 1 ) )) AND (spree_prices.currency = 'USD') AND (spree_prices.amount IS NOT NULL) LIMIT 1 OFFSET 0) subquery_for_count