SELECT COUNT(*) AS count_all, group_id AS group_id FROM `users` INNER JOIN `groups_users` `users_groups_users_join` ON `users_groups_users_join`.`user_id` = `users`.`id` INNER JOIN `users` `gu` ON `gu`.`id` = `users_groups_users_join`.`group_id` AND `gu`.`type` IN ('Group', 'GroupBuiltin', 'GroupAnonymous', 'GroupNonMember') WHERE `users`.`type` IN ('User', 'AnonymousUser') GROUP BY group_id