SELECT "topics".* FROM "topics" LEFT OUTER JOIN topic_users AS tu ON (topics.id = tu.topic_id AND tu.user_id = 5217) LEFT JOIN group_archived_messages gm ON gm.topic_id = topics.id AND gm.group_id = 2822 WHERE ("topics"."deleted_at" IS NOT NULL) AND ( topics.id IN ( SELECT topic_id FROM topic_allowed_groups WHERE ( group_id IN ( SELECT group_id FROM group_users WHERE user_id = 5217 OR false ) ) AND group_id IN (SELECT id FROM groups WHERE name ilike 'd') )) AND "topics"."archetype" = 'private_message' AND "topics"."visible" = TRUE AND (gm.id IS NULL) ORDER BY topics.bumped_at DESC LIMIT 30