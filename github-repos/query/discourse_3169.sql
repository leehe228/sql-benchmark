SELECT "topics".* FROM "topics" LEFT OUTER JOIN topic_users AS tu ON (topics.id = tu.topic_id AND tu.user_id = 5228) LEFT JOIN user_archived_messages um ON um.user_id = 5228 AND um.topic_id = topics.id WHERE ("topics"."deleted_at" IS NOT NULL) AND (topics.id IN (SELECT topic_id FROM topic_allowed_users WHERE user_id = 5228)) AND "topics"."archetype" = 'private_message' AND "topics"."visible" = TRUE AND (EXISTS ( SELECT 1 FROM posts WHERE posts.topic_id = topics.id AND posts.user_id = 5228 )) AND (um.user_id IS NULL) ORDER BY topics.bumped_at DESC LIMIT 30