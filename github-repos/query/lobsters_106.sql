SELECT users.id, users.username, (sum(downvotes) - 0)/0 as sigma, count(distinct if(downvotes > 0, comments.id, null)) as n_comments, count(distinct if(downvotes > 0, story_id, null)) as n_stories, sum(downvotes) as n_downvotes, sum(downvotes)/count(distinct comments.id) as average_downvotes, ( count(distinct if(downvotes>0, comments.id, null)) / count(distinct comments.id) ) * 100 as percent_downvoted FROM `users` INNER JOIN `comments` ON `comments`.`user_id` = `users`.`id` WHERE `users`.`banned_at` IS NULL AND `users`.`deleted_at` IS NULL AND (comments.created_at >= '2020-04-16 15:39:12.952729') GROUP BY comments.user_id HAVING (n_comments > 4 and n_stories > 1 and n_downvotes >= 10 and percent_downvoted > 10) ORDER BY sigma desc LIMIT 30