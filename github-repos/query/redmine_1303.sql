SELECT `users`.* FROM `users` WHERE `users`.`type` IN ('User', 'AnonymousUser') AND (users.status <> 0) AND `users`.`status` = 1 AND (LOWER(users.login) LIKE LOWER('%John%') OR users.id IN (SELECT user_id FROM email_addresses WHERE LOWER(address) LIKE LOWER('%John%')) OR ((LOWER(users.firstname) LIKE LOWER('%John%') OR LOWER(users.lastname) LIKE LOWER('%John%')))) ORDER BY login ASC