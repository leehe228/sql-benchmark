SELECT DISTINCT ON (deployments.environment_id) ci_pipeline_variables.* FROM "ci_pipeline_variables" INNER JOIN "ci_pipelines" ON "ci_pipelines"."id" = "ci_pipeline_variables"."pipeline_id" INNER JOIN "ci_builds" ON "ci_builds"."commit_id" = "ci_pipelines"."id" AND "ci_builds"."type" = $1 INNER JOIN "deployments" ON "deployments"."deployable_id" = "ci_builds"."id" AND "deployments"."deployable_type" = $2 INNER JOIN "environments" ON "environments"."id" = "deployments"."environment_id" INNER JOIN "deployments" "last_visible_deployments_environments" ON "last_visible_deployments_environments"."environment_id" = "environments"."id" AND "last_visible_deployments_environments"."status" IN ($3, $4, $5, $6) WHERE ("environments"."state" IN ('available')) AND "deployments"."status" = $7 AND "ci_pipeline_variables"."key" = $8 ORDER BY deployments.environment_id, deployments.id DESC /*application:test,controller:application_settings,action:usage_data,correlation_id:6a0c0fa1ca2505711e59296537dcdff3*/