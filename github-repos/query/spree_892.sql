SELECT `spree_variants`.* FROM `spree_variants` WHERE `spree_variants`.`deleted_at` IS NULL AND (`spree_variants`.`is_master` = FALSE OR ( `spree_variants`.id IN ( SELECT MIN(`spree_variants`.id) FROM `spree_variants` GROUP BY `spree_variants`.product_id HAVING COUNT(*) = 1 ) ))