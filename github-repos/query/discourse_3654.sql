SELECT "topics".* FROM "topics" LEFT JOIN topic_users tu ON topics.id = tu.topic_id AND tu.user_id = 6226 LEFT JOIN ( SELECT * FROM topic_allowed_groups _tg LEFT JOIN group_users gu ON gu.user_id = 6226 AND gu.group_id = _tg.group_id WHERE gu.group_id IN (2896) ) tg ON topics.id = tg.topic_id LEFT JOIN topic_allowed_users ta2 ON topics.id = ta2.topic_id AND ta2.user_id IN (6231,6232) LEFT JOIN topic_allowed_groups tg2 ON topics.id = tg2.topic_id AND tg2.group_id IN (2897) WHERE ("topics"."deleted_at" IS NOT NULL) AND (topics.archetype = 'private_message') AND (tg.topic_id IS NOT NULL) AND (ta2.topic_id IS NOT NULL OR tg2.topic_id IS NOT NULL) AND (topics.id NOT IN (18516)) AND "topics"."visible" = TRUE ORDER BY topics.bumped_at DESC LIMIT 6