SELECT "groups"."id", "groups"."name" FROM "groups" WHERE ( groups.id IN ( SELECT id FROM groups WHERE visibility_level = 0 UNION ALL SELECT id FROM groups WHERE visibility_level = 1 AND NULL IS NOT NULL UNION ALL SELECT g.id FROM groups g JOIN group_users gu ON gu.group_id = g.id AND gu.user_id = NULL WHERE g.visibility_level = 2 UNION ALL SELECT g.id FROM groups g LEFT JOIN group_users gu ON gu.group_id = g.id AND gu.user_id = NULL AND gu.owner WHERE g.visibility_level = 3 AND (gu.id IS NOT NULL OR FALSE) UNION ALL SELECT g.id FROM groups g JOIN group_users gu ON gu.group_id = g.id AND gu.user_id = NULL AND gu.owner WHERE g.visibility_level = 4 ) ) ORDER BY name ASC, "groups"."name" ASC