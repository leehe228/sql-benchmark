SELECT `queries`.* FROM `queries` LEFT OUTER JOIN projects ON queries.project_id = projects.id WHERE `queries`.`type` IN ('ProjectQuery') AND (queries.project_id IS NULL OR (((projects.status <> 9) AND ((projects.is_public = TRUE AND projects.id NOT IN (SELECT project_id FROM members WHERE user_id IN (3,12))) OR projects.id IN (1))))) AND (queries.visibility = 2 OR (queries.visibility = 1 AND queries.id IN (SELECT DISTINCT q.id FROM queries q INNER JOIN queries_roles qr on qr.query_id = q.id INNER JOIN member_roles mr ON mr.role_id = qr.role_id INNER JOIN members m ON m.id = mr.member_id AND m.user_id = 3 INNER JOIN projects p ON p.id = m.project_id AND p.status <> 9 WHERE q.project_id IS NULL OR q.project_id = m.project_id)) OR queries.user_id = 3) AND `queries`.`project_id` IS NULL ORDER BY `queries`.`name` ASC, `queries`.`id` ASC