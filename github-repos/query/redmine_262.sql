SELECT `custom_fields`.* FROM `custom_fields` WHERE `custom_fields`.`type` IN ('IssueCustomField') AND (is_for_all = TRUE OR EXISTS (SELECT 1 FROM custom_fields_projects cfp JOIN projects p ON p.id = cfp.project_id WHERE cfp.custom_field_id = custom_fields.id AND p.lft >= 1 AND p.rgt <= 10)) AND (custom_fields.visible = TRUE OR custom_fields.id IN (SELECT DISTINCT cfr.custom_field_id FROM members m INNER JOIN member_roles mr ON mr.member_id = m.id INNER JOIN custom_fields_roles cfr ON cfr.role_id = mr.role_id WHERE m.user_id = 2)) AND `custom_fields`.`is_filter` = TRUE ORDER BY `custom_fields`.`position` ASC