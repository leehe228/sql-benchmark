SELECT `versions`.* FROM `versions` INNER JOIN `projects` ON `projects`.`id` = `versions`.`project_id` WHERE (projects.id = 2 OR (projects.status <> 9 AND ( versions.sharing = 'system' OR (projects.lft >= 11 AND projects.rgt <= 12 AND versions.sharing = 'tree') OR (projects.lft < 11 AND projects.rgt > 12 AND versions.sharing IN ('hierarchy', 'descendants')) OR (projects.lft > 11 AND projects.rgt < 12 AND versions.sharing = 'hierarchy')))) AND `versions`.`status` = 'open'