SELECT COUNT(*) FROM todos INNER JOIN projects ON projects.id = todos.project_id WHERE todos.user_id = 1 AND todos.state IN ('pending') AND projects.id IN (SELECT projects.id FROM projects WHERE EXISTS (SELECT 1 FROM project_authorizations WHERE project_authorizations.user_id = 1 AND project_authorizations.project_id = projects.id) OR projects.visibility_level IN (10, 20)) AND projects.id IN (SELECT todos.project_id FROM todos WHERE todos.user_id = 1 AND todos.state IN ('pending'))